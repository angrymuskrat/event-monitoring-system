syntax = "proto3";

package proto;

import "data-storage/proto/gogo.proto";
import "proto/data.proto";

service DataStorage {
    // Push array of posts to database
    rpc PushPosts (PushPostsRequest) returns (PushPostsReply) {}

    // Select array from database, each element from array belongs the interval
    rpc SelectPosts (SelectPostsRequest) returns (SelectPostsReply) {}

    rpc PushGrid (PushGridRequest) returns (PushGridReply) {}

    rpc PullGrid (PullGridRequest) returns (PullGridReply) {}
}

// The push request contains two parameters.
message PushPostsRequest {
    repeated data.Post posts = 1 [(gogoproto.nullable) = false];
}

message PushPostsReply {
    repeated int32 ids = 1;
    string err = 2;
}

message SelectPostsRequest {
    data.SpatioTemporalInterval interval = 1 [(gogoproto.nullable) = false];
}

message SelectPostsReply {
    repeated data.Post posts = 1;
    string err = 2;
}

message PushGridRequest {
    string id = 1;
    bytes blob = 2;
}

message PushGridReply {
    string err = 1;
}

message PullGridRequest {
    string id = 1;
}

message PullGridReply {
    bytes blob = 1;
    string err = 2;
}

message PushEventsRequest {
    repeated data.EventShort events = 1 [(gogoproto.nullable) = false];
}

message PushEventsReply {
    string err = 1;
}

message PullEventsRequest {
    data.SpatioTemporalInterval interval = 1 [(gogoproto.nullable) = false];
}

message PullEventsReply {
    data.Events events = 1;
    string err = 2;
}
